<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
        <meta name="application-name" content="cobalt">
        <meta name="og:type" content="article">
        <meta name="twitter:card" content="summary">
        <link rel="preconnect" href="https://api.freesavevideo.online" crossorigin>

        <script>
            window.deferredPrompt = null;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                window.deferredPrompt = e;
            });
        </script>

        %sveltekit.head%

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-title" content="cobalt">

        <link rel="icon" type="image/png" href="%sveltekit.assets%/favicon.png">
        <link rel="icon" type="image/x-icon" href="%sveltekit.assets%/favicon.ico">
        <script>
            window.dataLayer = window.dataLayer || [];
            window.gtag = window.gtag || function () { window.dataLayer.push(arguments); };
            window.gtag("js", new Date());

            const runWhenIdle = (callback, timeout = 3000) => {
                if ("requestIdleCallback" in window) {
                    return window.requestIdleCallback(callback, { timeout });
                }
                return window.setTimeout(callback, Math.min(timeout, 1200));
            };

            const loadScript = (src, attrs = {}) => {
                const script = document.createElement("script");
                script.src = src;
                script.async = true;
                Object.entries(attrs).forEach(([key, value]) => {
                    if (value === true) {
                        script.setAttribute(key, "");
                    } else if (value !== false && value != null) {
                        script.setAttribute(key, String(value));
                    }
                });
                document.head.appendChild(script);
                return script;
            };

            const bootLateThirdPartyScripts = () => {
                if (window.__lateThirdPartyBooted) return;
                window.__lateThirdPartyBooted = true;

                loadScript("https://www.googletagmanager.com/gtag/js?id=G-9LGPCDJK2R").addEventListener("load", () => {
                    window.gtag("config", "G-9LGPCDJK2R");
                });

                loadScript(
                    "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7122886750315936",
                    { crossorigin: "anonymous" },
                );
            };

            const scheduleLateScripts = () => {
                window.setTimeout(() => {
                    if (document.hidden) return;
                    runWhenIdle(bootLateThirdPartyScripts, 12000);
                }, 45000);
            };
            window.addEventListener("load", scheduleLateScripts, { once: true });
            window.addEventListener("pointerdown", bootLateThirdPartyScripts, { once: true, passive: true });
            window.addEventListener("touchstart", bootLateThirdPartyScripts, { once: true, passive: true });
            window.addEventListener("keydown", bootLateThirdPartyScripts, { once: true });
        </script>
        <link rel="apple-touch-icon" sizes="180x180" href="%sveltekit.assets%/icons/apple-touch-icon.png">
        <link crossorigin="use-credentials" rel="manifest" href="%sveltekit.assets%/manifest.json">

        <noscript>
            <style>
                #cobalt { opacity: 1 !important }
            </style>
        </noscript>

        <style>
            body, #body-dark {
                background-color: black;
            }

            #body-light {
                background-color: white;
            }

            @media (prefers-color-scheme: light) {
                body {
                    background-color: white;
                }
            }

            #cobalt {
                opacity: 1;
            }
        </style>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                let settings = localStorage.getItem('settings'), appearance;
                if (settings) {
                    try {
                        ({ appearance } = JSON.parse(settings));
                        if (appearance?.theme) {
                            document.body.id = `body-${appearance.theme}`;
                        }
                    } catch { /* ignore */ }
                }
            });
        </script>
    </head>
    <body data-sveltekit-preload-data="hover" data-sveltekit-preload-code="hover">
        <div style="display: contents">
            %sveltekit.body%
        </div>
        <!-- Adsterra temporarily disabled. Re-enable by restoring the script tag below. -->
        <!-- <script type="text/javascript" src="//pl27990830.effectivegatecpm.com/f4/5a/98/f45a985961edc0f379ece3257b87407a.js"></script> -->
    </body>
</html>
